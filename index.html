<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-light: #642b73;
            --primary-dark: #c6426e;
            --accent: #c6426e;
            --danger: #6c757d;
            /* Abu-abu gelap untuk switch mati */
            --success: #c6426e;
            /* Magenta terang untuk switch nyala */
            --text-muted: #7a7a7a;
            /* Abu-abu netral */
        }

        /* Custom Navbar */
        .navbar-dark.bg-primary {
            background: linear-gradient(45deg, var(--primary-light), var(--primary-dark)) !important;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-size: 1.6rem;
            letter-spacing: 1.5px;
            font-weight: 300;
        }

        .navbar-brand strong {
            font-weight: 700;
        }

        .nav-link {
            font-weight: 500;
            position: relative;
            margin: 0 15px;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        /* Custom Switch */
        .form-switch .form-check-input {
            width: 3.8em;
            height: 2em;
            margin-right: 20px;
            background-color: var(--danger);
            /* Saat mati */
            border-color: var(--danger);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-switch .form-check-input:checked {
            background-color: var(--success);
            /* Saat nyala (Magenta terang) */
            border-color: var(--success);
        }

        .form-switch .form-check-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(198, 66, 110, 0.5);
        }

        .form-switch .form-check-input::before {
            height: 1.6em;
            width: 1.6em;
            top: 0.2em;
            left: 0.2em;
            background-color: white;
        }

        /* Lampu Icon */
        .lampu-icon {
            font-size: 2.2rem;
            transition: all 0.3s ease;
        }

        .icon-active {
            color: var(--success);
            filter: drop-shadow(0 0 8px rgba(198, 66, 110, 0.4));
        }

        .icon-inactive {
            color: var(--text-muted);
            opacity: 0.7;
        }


        /* Custom Navbar Toggler */
        .navbar-toggler {
            border: none;
            padding: 0.5rem;
        }

        .navbar-toggler:focus {
            box-shadow: none;
            outline: none;
        }

        .navbar-toggler-icon {
            background-image: none;
            position: relative;
            width: 24px;
            height: 2px;
            background-color: white;
            transition: all 0.3s ease;
        }

        .navbar-toggler-icon::before,
        .navbar-toggler-icon::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 2px;
            background-color: white;
            left: 0;
            transition: all 0.3s ease;
        }

        .navbar-toggler-icon::before {
            transform: translateY(-8px);
        }

        .navbar-toggler-icon::after {
            transform: translateY(8px);
        }

        /* Animasi saat aktif */
        .navbar-toggler[aria-expanded="true"] .navbar-toggler-icon {
            background-color: transparent;
        }

        .navbar-toggler[aria-expanded="true"] .navbar-toggler-icon::before {
            transform: rotate(45deg);
        }

        .navbar-toggler[aria-expanded="true"] .navbar-toggler-icon::after {
            transform: rotate(-45deg);
        }
    </style>

</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm py-3">
        <div class="container">
            <a class="navbar-brand" href="index.php">IoT<strong>Cloud</strong></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.php">Dashboard</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="container mt-5">
        <h1>Light Control</h1>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-1 g-4">

            <!-- Lampu 1 -->
            <div class="col">
                <div class="card shadow-sm border-0">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i id="icon-lampu-1" class="lampu-icon fas fa-lightbulb me-3 icon-inactive"></i>
                                <h5 class="m-0" style="color: #264653;">Lampu 1</h5>
                            </div>
                            <div class="form-check form-switch">
                                <input id="switch-lampu-1" class="form-check-input" type="checkbox">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- akhir lampu 1 -->

            <!-- Lampu 2 -->
            <div class="col">
                <div class="card shadow-sm border-0">
                    <div class="card-body py-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <i id="icon-lampu-2" class="lampu-icon fas fa-lightbulb me-3 icon-inactive"></i>
                                <h5 class="m-0" style="color: #264653;">Lampu 2</h5>
                            </div>
                            <div class="form-check form-switch">
                                <input id="switch-lampu-2" class="form-check-input" type="checkbox">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- akhir lampu 2 -->

        </div>


    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mqtt/5.10.4/mqtt.min.js"
        integrity="sha512-U6juml/sd5ivQOO5Nmd3IB8DUgRYRJ3whk/+oxaOJHyA9WtXXl3p42YoevQ7/PnuZR1Oir607H3A/+AjQ/gWug=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>
    <script>
        // Ganti dengan alamat WebSocket broker EMQX-mu
        const brokerUrl = 'wss://broker.emqx.io:8084/mqtt'; // bisa juga ws://YOUR_IP:8083/mqtt
        const clientId = 'web-client-' + Math.random().toString(16).substr(2, 8);

        const options = {
            clientId: clientId,
            clean: true,
            connectTimeout: 4000,
            username: '', // jika ada
            password: '', // jika ada
        };

        const client = mqtt.connect(brokerUrl, options);

        client.on('connect', () => {
            console.log('Tersambung ke EMQX Broker');
        });

        client.on('error', (err) => {
            console.error('MQTT Error:', err);
        });

        // Fungsi untuk publish status lampu
        function updateStatusLampu(id, status) {
            const topic = `lampu/9829121/${id}/status`;
            client.publish(topic, status, { qos: 0 }, (err) => {
                if (err) {
                    console.error(`Gagal kirim ke ${topic}:`, err);
                } else {
                    console.log(`Status ${status} dikirim ke ${topic}`);
                }
            });
        }

        const switchLampu1 = document.getElementById('switch-lampu-1');
        const iconLampu1 = document.getElementById('icon-lampu-1');

        switchLampu1.addEventListener('change', function () {
            const status = this.checked ? 'ON' : 'OFF';
            // Update icon tampilan
            iconLampu1.classList.toggle('icon-active', status === 'ON');
            iconLampu1.classList.toggle('icon-inactive', status === 'OFF');

            updateStatusLampu(1, status);

        });


        const switchLampu2 = document.getElementById('switch-lampu-2');
        const iconLampu2 = document.getElementById('icon-lampu-2');

        switchLampu2.addEventListener('change', function () {
            const status = this.checked ? 'ON' : 'OFF';
            // Update icon tampilan
            iconLampu2.classList.toggle('icon-active', status === 'ON');
            iconLampu2.classList.toggle('icon-inactive', status === 'OFF');

            updateStatusLampu(2, status);
        });

    </script>
</body>

</html>